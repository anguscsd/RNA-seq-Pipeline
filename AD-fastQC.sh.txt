#!/bin/bash

sampleIDs=("ERR2704713_subset")

userProject="scw1557"
mem="20G"
nodes="1"
runTime="00:05:00"

myDir=$(pwd)
scriptBase="03"
jobName="ADqc"


for sampleID in "${sampleIDs[@]}"
do
	scriptName=${myDir}/../temp/${scriptBase}.${sampleID}.sh
	rm -rf ${scriptName} || true
	touch ${scriptName}

	echo "#!/bin/bash" >> ${scriptName} 
        echo "#SBATCH -p compute" >> ${scriptName}
        echo "#SBATCH --mem=${mem}" >> ${scriptName}
        echo "#SBATCH --ntasks=${nodes}" >> ${scriptName}
        echo "#SBATCH --tasks-per-node=${nodes}" >> ${scriptName}
        echo "#SBATCH -t ${runTime}" >> ${scriptName}
        echo "#SBATCH -o ${myDir}/OUT/${scriptBase}${jobName}.%J" >> ${scriptName}
        echo "#SBATCH -e ${myDir}/ERR/${scriptBase}${jobName}.%J" >> ${scriptName}
        echo "#SBATCH --job-name=${jobName}" >> ${scriptName}
        echo "#SBATCH --account=${userProject}" >> ${scriptName}

	echo "module load java/1.8" >> ${scriptName}	
	echo "module load FastQC/0.11.8" >> ${scriptName}	

	echo "mkdir -p ${myDir}/../output/${sampleID}/fastqc/raw/" >> ${scriptName}	
	echo "mkdir -p ${myDir}/../output/${sampleID}/fastqc/trimmed/" >> ${scriptName}	

	## run fastqc on the raw fastq

	echo "fastqc -o ${myDir}/../output/${sampleID}/fastqc/raw/ ${myDir}/../input/${sampleID}_1.fastq.gz ${myDir}/../input/${sampleID}_2.fastq.gz" >> ${scriptName}	

	## run fastqc on the trimmed fastq

	echo "fastqc -o ${myDir}/../output/${sampleID}/fastqc/trimmed/ ${myDir}/../output/${sampleID}/trimmomatic/${sampleID}.trim_1.fq.gz ${myDir}/../output/${sampleID}/trimmomatic/${sampleID}.trim_2.fq.gz" >> ${scriptName}	


	chmod u+x ${scriptName}

	sbatch ${scriptName}

done
